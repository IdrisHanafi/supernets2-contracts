on:
    push:
      tags:
      - 'v[0-9]+.[0-9]+.[0-9]+*' # this action will only run on tags that follow semver
  
  jobs:
    build:
      runs-on: ubuntu-latest
  
      strategy:
        matrix:
          node-version: [14.x]
  
      steps:
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v1
          with:
            node-version: ${{ matrix.node-version }}

        - name: Checkout code
          uses: actions/checkout@v2

        - name: Login to DockerHub
          uses: docker/login-action@v1
          with:
            username: ${{ secrets.DOCKERHUB_USERNAME }}
            password: ${{ secrets.DOCKERHUB_TOKEN }}

        - name: Build docker
          run: |
            npm i
            npm run docker:contracts
          docker image tag hermeznetwork/geth-supernets2-contracts hermeznetwork/geth-supernets2-contracts:${{ github.ref_name }}
          docker image push hermeznetwork/geth-supernets2-contracts:${{ github.ref_name }}